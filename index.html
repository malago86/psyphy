<head>
<meta charset="UTF-8">
<title>PSY&#9898;PHY - Online psychophysics experiments for all</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
<script src="/js/jquery.key.js"></script>
<script src="https://cdn.jsdelivr.net/npm/js-cookie@rc/dist/js.cookie.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mobile-detect@1.4.4/mobile-detect.min.js"></script>
<script src="/js/functions.js"></script>
<script src="/js/main.js"></script>
<script src="/js/google_drive.js"></script>
<link rel="stylesheet" type="text/css" href="/css/style.css">
<link rel="icon" href="/favicon.ico" type="image/x-icon" />
<link href="/css/fontawesome.css" rel="stylesheet"> 
</head>
<body>
    <div class="background">
        <div id="form-container">
            <img src="/images/psyphy.png" class="logo" width="600">
            
            <p><strong>Try the test experiment: </strong>Enter your name and click on Start. Calibration will start first.</p>
            <p><strong>Load your experiment:</strong> Upload an experiment file to load experiment configuration. <br>Enter your name and click on Start. Calibration will start first.</p>
            
            <div class="credits">Developed by <a href="javascript:location='mailto:\u006c\u0061\u0067\u006f\u0040\u0070\u0073\u0079\u0063\u0068\u002e\u0075\u0063\u0073\u0062\u002e\u0065\u0064\u0075';void 0">Miguel Lago</a><br>
                for <a href="https://viu.psych.ucsb.edu" target="_blank">VIU lab at UCSB</a>
                <br>
                version <a id="version" href="https://gitlab.com/malago/psyphy" target="_blank"></a>
            </div> 
            
            <div class="error"></div>
            
            <input id="name" type="text" placeholder="Name" value="" />
            <!--Screen size (<span class="question-mark">&#10067;</span>): <input id="width" type="text" placeholder="width" value="23" /> by <input id="height" type="text" placeholder="height" value="13" /> 
            <select id="units">
                <option>inches</option>
                <option>cm</option>
            </select>-->
            
            
            <input type="button" id="start-experiment" value="Start!" />
            <br>
            <p>By clicking on Start you accept the experiment conditions and consent form (if given).</p>
            <label id="load-experiment-label" for="load-experiment"><i class="fas fa-file-upload"></i> Upload experiment file</label>
            
            <input type="file" accept=".pso" id="load-experiment" value="Upload experiment file" style="font-size:14px; height:17px;line-height: 0px;"/>
            
            
            
            <form class="form-box" id="form-box">
                <p style="font-weight: bold;
                border-bottom: 2px solid white;
                margin: auto;
                margin-bottom: 15px;
                width: 80%;" id="create-title"><i class="far fa-plus-square icon"></i> Create experiment</p>
                <div id="create-toggle">
                    <table>
                        <tr>
                            <th>Title</th>
                            <td><input id="title" type="text" style="font-size:20px; width:100%;text-align:center" placeholder="optional"/></td>
                        </tr>
                        <tr>
                            <th>Instructions URL</th>
                            <td><input id="instructions" type="text" placeholder="optional" style="width:100%;text-align:center"/></td>
                        </tr>
                        <tr>
                            <th># ratings</th>
                            <td>
                                <div id="slider-value">8</div>
                                <div class="slidecontainer">
                                    <input type="range" min="1" max="12" value="8" class="slider" id="ratings">
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <th><abbr title="Allow double click to mark the stimulus">Marks</abbr></th>
                            <td><input id="mark" type="checkbox" style="font-size:20px; width:100%;text-align:center"/></td>
                        </tr>
                        <tr>
                            <th><a href="https://keycode.info/" target="_blank" title="Comma-separated list of allowed keyboard key codes to continue">Allowed keys</a></th>
                            <td><input id="keys" type="text" value="Space" style="width:100%;text-align:center"/></td>
                        </tr>
                        <tr>
                            <th><abbr title="Randomize">Randomize trials</abbr></th>
                            <td>
                                <select id="randomize" style="width:100%;font-size:16px;margin-top:0;height:26px;">
                                    <option value="all" title="Randomize all trials regardless of the condition">Randomize all</option>
                                    <option value="randomrandom" title="Block conditions and randomize their order, randomize trials inside the conditions">Random blocks, random trials</option>
                                    <option value="keeprandom" title="Block conditions and keep their order, randomize trials inside the conditions">Ordered blocks, random trials</option>
                                    <option value="randomkeep" title="Block conditions and randomize their order, keep trial order inside the conditions">Random blocks, ordered trials</option>
                                    <option value="keepkeep" title="Keep order for conditions and trials inside the conditions">Do not randomize</option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <th><abbr title="Behavior if several images are found in each stimulus folder">Multiple stimulus</abbr></th>
                            <td>
                                <select id="multiple" style="margin-top:0;height:26px;font-size:16px;width:100%">
                                    <option value="first">Show first</option>
                                    <option value="MAFC">MAFC</option>
                                    <option value="3D">3D scroll</option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <th><abbr title="Recalibration interval in minutes, set to empty or 0 to disable">Calibration interval</abbr></th>
                            <td><input id="calibration" type="number" placeholder="calibration" style="font-size:20px; width:100%;text-align:center" value="10"/></td>
                        </tr>
                        <tr>
                            <th>Trial timeout (<abbr title="milliseconds, set to empty or 0 to disable">ms</abbr>)</th>
                            <td><input id="timeout" type="number" placeholder="optional" style="font-size:20px; width:100%;text-align:center"/></td>
                        </tr>
                    </table>
                    <br><input type="button" id="google-drive-select" value="Find stimuli on Google Drive" /><br>
                    <input type="button" id="create-experiment" value="Download experiment config" class="disabled"/>
                </div>
            </form>
                
        </div>
        <div id="loading-bar">
            <div id="loading-bar-text">Loading... <i class="fas fa-spinner fa-spin"></i></div>
            <div id="loading-bar-progress"></div>
        </div>

        <div id="trial-container">
            <div class="cell">
                <div class="text">
                    <div>Find the signal in the image. Use the mouse wheel or drag the scrollbar to change the slice<br><br>
                         Press ESC to quit the experiment, data will be lost<br><br>
                         Press SPACEBAR to continue
                    </div>
                </div>
                <div id="stimulus-container">
                    <div id="trial-number"></div>
                    <div id="stimulus-slice">Slice: 1</div>
                    <div id="stimulus">
                        <img class="stimulus-img">
                    </div>
                    <div id="stimulus-scroll-bar">
                        <div id="stimulus-scroll-background"></div>
                        <div id="stimulus-scroll-position"></div>
                    </div>
                    <div class="instructions" id="trial-spacebar">Press SPACEBAR to continue</div>
                </div>
                
            </div>
        </div>

        <div id="response-container">
            <span>
                <div id="response-text"></div>
                <div id="confidence-scale">
                    <div class="rating absent" num="1">1</div>
                    <div class="rating present" num="2">2</div>
                </div>
            </span>
        </div>

        <div id="feedback-container">
            <div class="cell">
                <img class="stimulus-img">
                <div class="instructions">Press SPACEBAR to continue</div>
            </div>
        </div>

        <div id="finished-container">
            <div class="instructions" style="margin-top:100px">
                <p>You finished all the trials, your data has been uploaded!</p>
                <p>Thanks for participating, <a href=".">click here to go back</a>.</p>
                <p><span id="download-data"></span></p>
            </div>
        </div>

        <div id="help" class="form-box">
            <p id="resolution"></p>
            <p id="monitor-size"></p>
            <p id="image-size"></p>
            <p id="image-real-size"></p>
            <p id="distance-required"></p>
        </div>

        <div class="popup" id="help-screen">
            <p></p>
            <img src="/images/screen-measurement.png" height="300">
            <p>Measure your screen in cm or inches.</p>
            <p>Do not measure the screen border, only the interior of the display.</p>
            <div class="close">&#10060;</div>
        </div>
    </div>

    <div id="calibration" class="popup">
        <div class="close">&#10060;</div>
        <div id="calibration-step1">
            <p>Place a credit card in the top left corner of the square.</p>
            <p>Adjust the slider to match the size of your credit card in the screen.</p>
            <p style="font-size: 12px;
            bottom: 0;
            position: absolute;
            left: 0;
            width: 50%;
            margin: 10px;">Li, Q., Joo, S.J., Yeatman, J.D. et al. Controlling for Participants' Viewing Distance in Large-Scale, Psychophysical Online Experiments Using a Virtual Chinrest. Sci Rep 10, 904 (2020). <a href="https://doi.org/10.1038/s41598-019-57204-1" target="_blank">doi:10.1038/s41598-019-57204-1</a></p>
            <div class="credit-card-slider">
                <div class="credit-card-slider-position"></div>
            </div>
            <div class="credit-card-outline"></div>
            <div class="button">Continue</div>
        </div>
        <div id="calibration-step2" style="display:none">
            <p>Close your <strong>RIGHT eye</strong> and look at the cross.</p>
            <p>Without moving your eyes, press SPACEBAR when the white dot dissapears from your sight.</p>
            <div class="blind-spot-container">
                <div class="blind-spot-cross"></div>
                <div class="blind-spot-dot"></div>
            </div>
        </div>
        <div id="calibration-step3" style="display:none">
            <h1>Calibration succeded, <strong>do not move your head</strong> or adjust your body position. <br>
            You can start the experiment.</h1>
            <div class="button">Finish</div>
        </div>    
    </div>

    <div class="popup" id="google-drive-dialog">
        <div class="close">&#10060;</div>
        <p>Introduce the Google Drive Folder ID: <input id="google-drive-url" type="text" placeholder="https://drive.google.com/drive/..." 
            style="font-size:20px; width:90%;text-align:center" value=""/>
        <p><input type="button" id="google-drive-submit" value="Find files" /></p>
        <div id="google-drive-result"></div>
        <div class="button">Finish</div>
    </div>
</body>
